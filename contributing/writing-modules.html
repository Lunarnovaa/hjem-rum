<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contributing: Writing Modules</title>
    <script>
      // Apply sidebar state immediately to prevent flash
      (function () {
        if (localStorage.getItem("sidebar-collapsed") === "true") {
          document.documentElement.classList.add("sidebar-collapsed");
        }
      })();
    </script>
    <link rel="stylesheet" href="../assets/style.css" />
    <script defer src="../assets/main.js"></script>
    
    <script defer src="../assets/search.js"></script>
    
  </head>
  <body>
    <div class="container">
      <header>
        <div class="header-left">
          <h1 class="site-title">
            <a href="../index.html">Hjem Rum</a>
          </h1>
        </div>
        <nav class="header-nav">
          <ul>
            <li >
              <a href="../options.html">Options</a>
            </li>
            
            <li><a href="../search.html">Search</a></li>
            
          </ul>
        </nav>
        
        <div class="search-container">
          <input type="text" id="search-input" placeholder="Search..." />
          <div id="search-results" class="search-results"></div>
        </div>
        
      </header>

      <div class="layout">
        <div class="sidebar-toggle" aria-label="Toggle sidebar">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            width="24"
            height="24"
          >
            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
          </svg>
        </div>
        <nav class="sidebar">
          <div class="docs-nav">
            <h2>Documents</h2>
            <ul>
              <li><a href="../index.html">Hjem Rum</a></li>
<li><a href="../contributing/reviewing.html">Contributing: Review Tips</a></li>
<li><a href="../contributing/docs.html">Contributing: Extending the Documentation</a></li>
<li><a href="../contributing/testing.html">Contributing: Setting Up Module Tests</a></li>
<li><a href="../contributing/writing-modules.html">Contributing: Writing Modules</a></li>
<li><a href="../contributing/introduction.html">Contributing: Introduction</a></li>
<li><a href="../contributing/rumlib.html">Contributing: Extending Hjem Rum's Library</a></li>
<li><a href="../usage/installation.html">Usage: Installing Hjem Rum</a></li>
<li><a href="../usage/quirks.html">Usage: Quirks, Tips, & Tricks</a></li>
<li><a href="../search.html">Search</a></li>

            </ul>
          </div>

          <div class="toc">
            <h2>Contents</h2>
            <ul class="toc-list">
              <li><a href="#contributing-writing-modules">Contributing: Writing Modules</a>
<ul><li><a href="#ch-aliases">Aliases</a>
<li><a href="#ch-writing-options">Writing Options</a>
<ul><li><a href="#sec-package-overrides">Package Overrides</a>
<li><a href="#sec-nullable-package-options">Nullable Package Options</a>
<li><a href="#sec-type">Type</a>
<li><a href="#sec-submodules-nested-configuration">Submodules / Nested Configuration</a>
<li><a href="#sec-dependence-on-config">Dependence on config</a>
</ul><li><a href="#ch-conditionals-in-modules">Conditionals in Modules</a>
</li></ul></li>
            </ul>
          </div>
        </nav>

        <main class="content"><html><head></head><body><h1 id="contributing-writing-modules">Contributing: Writing Modules</h1>
<p>Writing modules is a core task of contributing to Hjem Rum, and makes up the
bulk of PRs. Learning to follow our guidelines, standards, and expectations in
writing modules is accordingly crucial. Please read the following to be made
aware of these.</p>
<h2 id="ch-aliases">Aliases</h2>
<p>At the top of any module, there should always be a <code>let ... in</code> set. Within
this, functions should have their location aliased, cfg should be aliased, and
any generators should have an alias as well. Here's an example for a module that
makes use of the TOML generator used in Nixpkgs:</p>
<pre class="highlight"><code class="language-nix"><span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;<span style="color:rgb(232,102,113);">config</span><span style="color:rgb(132,139,152);">,</span><br>&nbsp;&nbsp;<span style="color:rgb(232,102,113);">lib</span><span style="color:rgb(132,139,152);">,</span><br>&nbsp;&nbsp;<span style="color:rgb(232,102,113);">pkgs</span><span style="color:rgb(132,139,152);">,</span><br>&nbsp;&nbsp;<span style="color:rgb(232,102,113);">...</span><br><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">:</span>&nbsp;<span style="color:rgb(198,120,221);">let</span><br>&nbsp;&nbsp;<span style="color:rgb(92,99,112);font-style: italic;">#&nbsp;in&nbsp;case&nbsp;you&nbsp;are&nbsp;unfamiliar,&nbsp;'inherit&nbsp;func;'&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;'func&nbsp;=&nbsp;func;',&nbsp;and</span><br>&nbsp;&nbsp;<span style="color:rgb(92,99,112);font-style: italic;">#&nbsp;'inherit&nbsp;(cfg)&nbsp;func;'&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;'func&nbsp;=&nbsp;cfg.func;'</span><br>&nbsp;&nbsp;<span style="color:rgb(198,120,221);">inherit</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(171,178,191);">lib</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">modules</span><span style="color:rgb(132,139,152);">)</span>&nbsp;mkIf<span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;<span style="color:rgb(198,120,221);">inherit</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(171,178,191);">lib</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">options</span><span style="color:rgb(132,139,152);">)</span>&nbsp;mkOption&nbsp;mkEnableOption&nbsp;mkPackageOption<span style="color:rgb(132,139,152);">;</span><br><br>&nbsp;&nbsp;toml&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(171,178,191);">pkgs</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">formats</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(97,175,239);">toml</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br><br>&nbsp;&nbsp;cfg&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(171,178,191);">config</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">rum</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">programs</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">alacritty</span><span style="color:rgb(132,139,152);">;</span><br><span style="color:rgb(198,120,221);">in</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;options<span style="color:rgb(132,139,152);">.</span>rum<span style="color:rgb(132,139,152);">.</span>programs<span style="color:rgb(132,139,152);">.</span>alacritty&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br></code></pre>
<p>Notice that each function has its location aliased with an inherit to its target
location. Ideally, this location should be where one could find it in the source
code. For example, rather than using <code class="file-path">lib.mkIf</code>, we use
<code class="file-path">lib.modules.mkIf</code>, because mkIf is declared at <code>lib/modules.nix</code> within
the Nixpkgs repo.</p>
<p>Also notice that in this case, <code>pkgs.formats.toml {}</code> includes both <code>generate</code>
and <code>type</code>, so the alias name is just <code>toml</code>.</p>
<p>Always be sure to include <code>cfg</code> that links to the point where options are
configured by the user.</p>
<h2 id="ch-writing-options">Writing Options</h2>
<p>Writing new options is the core of any new module. It is also the easiest place
to blunder. As stated above, a core principle of HJR is to minimize the number
of options as much as possible. As such, we have created a general template that
should help inform you of what options are needed and what are not:</p>
<ul>
<li><code>enable</code>: Used to toggle install and configuration of package(s).</li>
<li><code>package</code>: Used to customize and override the package installed.
<ul>
<li>As needed, <code>packages</code>: List of packages used in a module.</li>
</ul>
</li>
<li><code>settings</code>: Primary configuration option, takes Nix code and converts to
target lang.
<ul>
<li>As needed, one extra option for each extra file, such as <code>theme</code> for
theme.toml.</li>
</ul>
</li>
<li>As needed, <code>extraConfig</code>: Extra lines of strings passed directly to config
file for certain programs.</li>
</ul>
<p>For the most part, this should be sufficient.</p>
<h3 id="sec-package-overrides">Package Overrides</h3>
<p>Overrides of packages should be simply offered through a direct override in
<code>package</code>. For example, ncmpcpp's package has a <code>withVisualizer ? false</code>
argument. Rather than creating an extra option for this, the contributor should
note this with <code>extraDescription</code>, and give an example of it like so:</p>
<pre class="highlight"><code class="language-nix"><span style="color:rgb(171,178,191);">options</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">rum</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">programs</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(97,175,239);">ncmpcpp</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;<span style="color:rgb(86,182,194);">enable</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(97,175,239);">mkEnableOption</span>&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">ncmpcpp,&nbsp;a&nbsp;mpd-based&nbsp;music&nbsp;player.</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">;</span><br><br>&nbsp;&nbsp;<span style="color:rgb(86,182,194);">package</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(97,175,239);">mkPackageOption</span>&nbsp;<span style="color:rgb(171,178,191);">pkgs</span>&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">ncmpcpp</span><span style="color:rgb(152,195,121);">"</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">nullable</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(209,154,102);">true</span><span style="color:rgb(132,139,152);">;</span>&nbsp;<span style="color:rgb(92,99,112);font-style: italic;">#&nbsp;Always&nbsp;enable&nbsp;`nullable`&nbsp;in&nbsp;`mkPackageOption`.&nbsp;Usually,&nbsp;this&nbsp;would&nbsp;be&nbsp;inline.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">extraDescription</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(152,195,121);">''</span><span style="color:rgb(152,195,121);"></span><br><span style="color:rgb(152,195,121);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;You&nbsp;can&nbsp;override&nbsp;the&nbsp;package&nbsp;to&nbsp;customize&nbsp;certain&nbsp;settings&nbsp;that&nbsp;are&nbsp;baked</span><br><span style="color:rgb(152,195,121);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;into&nbsp;the&nbsp;package.</span><br><span style="color:rgb(152,195,121);">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:rgb(152,195,121);">''</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(92,99,112);font-style: italic;">#&nbsp;Note&nbsp;that&nbsp;mkPackageOption's&nbsp;example&nbsp;automatically&nbsp;uses&nbsp;literalExpression</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">example</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(152,195,121);">''</span><span style="color:rgb(152,195,121);"></span><br><span style="color:rgb(152,195,121);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pkgs.ncmpcpp.override&nbsp;{</span><br><span style="color:rgb(152,195,121);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;useful&nbsp;overrides&nbsp;in&nbsp;the&nbsp;package</span><br><span style="color:rgb(152,195,121);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outputsSupport&nbsp;=&nbsp;true;&nbsp;#&nbsp;outputs&nbsp;screen</span><br><span style="color:rgb(152,195,121);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;visualizerSupport&nbsp;=&nbsp;false;&nbsp;#&nbsp;visualizer&nbsp;screen</span><br><span style="color:rgb(152,195,121);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clockSupport&nbsp;=&nbsp;true;&nbsp;#&nbsp;clock&nbsp;screen</span><br><span style="color:rgb(152,195,121);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;taglibSupport&nbsp;=&nbsp;true;&nbsp;#&nbsp;tag&nbsp;editor</span><br><span style="color:rgb(152,195,121);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</span><br><span style="color:rgb(152,195,121);">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:rgb(152,195,121);">''</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;<span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br></code></pre>
<p>and the user could simply pass:</p>
<pre class="highlight"><code class="language-nix"><span style="color:rgb(171,178,191);">config</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">hjem</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(97,175,239);">users</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(232,102,113);">&lt;username&gt;</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">rum</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">programs</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">ncmpcpp</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">enable</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(209,154,102);">true</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">package</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(171,178,191);">pkgs</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">ncmpcpp</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(97,175,239);">override</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">withVisualizer</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(209,154,102);">true</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">)</span><span style="color:rgb(132,139,152);">;</span><br><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br></code></pre>
<h3 id="sec-nullable-package-options">Nullable Package Options</h3>
<p>When using <code>mkPackageOption</code>, you should always be sure to enable <code>nullable</code>, so
that the user can choose not to have Hjem Rum install the package into the
user's environment.</p>
<pre class="highlight"><code class="language-nix"><span style="color:rgb(171,178,191);">options</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">rum</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">programs</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(97,175,239);">alacritty</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">enable</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(97,175,239);">mkEnableOption</span>&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">Alacritty</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">;</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">package</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(97,175,239);">mkPackageOption</span>&nbsp;<span style="color:rgb(171,178,191);">pkgs</span>&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">alacritty</span><span style="color:rgb(152,195,121);">"</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><span style="color:rgb(86,182,194);">nullable</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(209,154,102);">true</span><span style="color:rgb(132,139,152);">;</span><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br></code></pre>
<p><code>mkPackageOption</code> is a function with three required arguments: the source of the
package (usually <code>pkgs</code>), the name of the package, and an attribute set for
configuration. The latter has several options, such as <code>extraDescription</code>,
<code>example</code>, and, in this case <code>nullable</code>. For a complete list of options for this
function, see <a href="https://noogle.dev/f/lib/options/mkPackageOption">Noogle's page on it</a>.</p>
<p>Because the user can set the package to null, however, we must check for this
before adding the package to the user's environment, as adding <code>null</code> would
result in an error. Thankfully, this is relatively simple:</p>
<pre class="highlight"><code class="language-nix"><span style="color:rgb(97,175,239);">config</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(171,178,191);">mkIf</span>&nbsp;<span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">enable</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">packages</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(97,175,239);">mkIf</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">package</span>&nbsp;<span style="color:rgb(171,178,191);">!=</span>&nbsp;<span style="color:rgb(209,154,102);">null</span><span style="color:rgb(132,139,152);">)</span>&nbsp;<span style="color:rgb(132,139,152);">[</span><span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">package</span><span style="color:rgb(132,139,152);">]</span><span style="color:rgb(132,139,152);">;</span><br><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br></code></pre>
<p>This simply checks if the package is null before adding it to the list.</p>
<h3 id="sec-type">Type</h3>
<p>The <code>type</code> of <code>settings</code> and other conversion options should preferably be a
<code>type</code> option exposed by the generator (for example, TOML has
<code>pkgs.formats.toml {}.type</code> and <code>pkgs.formats.toml {}.generate</code>), or, if using a
custom generator, a <code>type</code> should be created in <code>lib/types/</code> (for example,
<code>hyprType</code>). Otherwise, a simple <code>attrsOf anything</code> would suffice.</p>
<h3 id="sec-submodules-nested-configuration">Submodules / Nested Configuration</h3>
<p>As a rule of thumb, submodules should not be employed. Instead, there should
only be one option per file. For some files, such as spotify-player's
<code class="file-path">keymap.toml</code>, you may be tempted to create multiple options for <code>actions</code>
and <code>keymaps</code>, as Home Manager does. Please avoid this. In this case, we can
have a simple <code>keymap</code> option that the user can then include a list of keymaps
and/or a list of actions that get propagated accordingly:</p>
<pre class="highlight"><code class="language-nix">&nbsp;&nbsp;<span style="color:rgb(97,175,239);">keymap</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(171,178,191);">mkOption</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(198,120,221);">inherit</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(171,178,191);">toml</span><span style="color:rgb(132,139,152);">)</span>&nbsp;type<span style="color:rgb(132,139,152);">;</span>&nbsp;<span style="color:rgb(92,99,112);font-style: italic;">#&nbsp;We&nbsp;can&nbsp;use&nbsp;a&nbsp;streamlined&nbsp;inherit&nbsp;to&nbsp;say&nbsp;type&nbsp;=&nbsp;toml.type</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">default</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">example</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">keymaps</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(132,139,152);">[</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">command</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">NextTrack</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">key_sequence</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">g&nbsp;n</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">]</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">actions</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(132,139,152);">[</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">action</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">GoToArtist</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">key_sequence</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">g&nbsp;A</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">]</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">description</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(152,195,121);">''</span><span style="color:rgb(152,195,121);"></span><br><span style="color:rgb(152,195,121);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sets&nbsp;of&nbsp;keymaps&nbsp;and&nbsp;actions&nbsp;converted&nbsp;into&nbsp;TOML&nbsp;and&nbsp;written&nbsp;to</span><br><span style="color:rgb(152,195,121);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{file}`$HOME/.config/spotify-player/keymap.toml`.</span><br><span style="color:rgb(152,195,121);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;See&nbsp;example&nbsp;for&nbsp;how&nbsp;to&nbsp;format&nbsp;declarations.</span><br><span style="color:rgb(152,195,121);"></span><br><span style="color:rgb(152,195,121);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Please&nbsp;reference&nbsp;https://github.com/aome510/spotify-player/blob/master/docs/config.md#keymaps</span><br><span style="color:rgb(152,195,121);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;more&nbsp;information.</span><br><span style="color:rgb(152,195,121);">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:rgb(152,195,121);">''</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;<span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br></code></pre>
<p>Also note that the option description includes a link to upstream info on
settings options.</p>
<h3 id="sec-dependence-on-config">Dependence on <code>config</code></h3>
<p>If an option is dependent on <code>config</code>, (e.g.
<code>default = config.myOption.enable;</code>) you must <em>also</em> set <code>defaultText</code> alongside
<code>default</code>. Example:</p>
<pre class="highlight"><code class="language-nix"><span style="color:rgb(97,175,239);">integrations</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(92,99,112);font-style: italic;">#&nbsp;We&nbsp;basically&nbsp;override&nbsp;the&nbsp;`default`&nbsp;and&nbsp;`defaultText`&nbsp;attrs&nbsp;in&nbsp;the&nbsp;mkEnableOption&nbsp;function</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">fish</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">enable</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(97,175,239);">mkEnableOption</span>&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">starship&nbsp;integration&nbsp;with&nbsp;fish</span><span style="color:rgb(152,195,121);">"</span>&nbsp;<span style="color:rgb(171,178,191);">//</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">default</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(171,178,191);">config</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">programs</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">fish</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">enable</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">defaultText</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">config.programs.fish.enable</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br></code></pre>
<p>It is essentially just a string that shows the user what the option is set to by
default. This can also be used in <code>mkOption</code>, but it is more common to use it in
<code>mkEnableOption</code>.</p>
<p>If you do not set this, the docs builder will break due to not knowing how to
resolve the reference to <code>config</code>.</p>
<h2 id="ch-conditionals-in-modules">Conditionals in Modules</h2>
<p>Always use a <code>mkIf</code> before the <code>config</code> section. Example:</p>
<pre class="highlight"><code class="language-nix"><span style="color:rgb(97,175,239);">config</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(171,178,191);">mkIf</span>&nbsp;<span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">enable</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(92,99,112);font-style: italic;">#&nbsp;Module&nbsp;code</span><br><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br></code></pre>
<p>As a general guideline, <strong>do not write empty strings to files</strong>. Not only is
this poorly optimized, but it will cause issues if a user happens to be manually
using the Hjem tooling alongside HJR. Here are some examples of how you might
avoid this:</p>
<pre class="highlight"><code class="language-nix"><span style="color:rgb(97,175,239);">config</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(171,178,191);">mkIf</span>&nbsp;<span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">enable</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;<span style="color:rgb(86,182,194);">packages</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(132,139,152);">[</span><span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">package</span><span style="color:rgb(132,139,152);">]</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;<span style="color:rgb(86,182,194);">files</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">.config/alacritty/alacritty.toml</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">source</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(97,175,239);">mkIf</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">settings</span>&nbsp;<span style="color:rgb(171,178,191);">!=</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">)</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(171,178,191);">toml</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(97,175,239);">generate</span>&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">alacritty.toml</span><span style="color:rgb(152,195,121);">"</span>&nbsp;<span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">settings</span>&nbsp;<span style="color:rgb(92,99,112);font-style: italic;">#&nbsp;The&nbsp;indentation&nbsp;makes&nbsp;it&nbsp;more&nbsp;readable</span><br>&nbsp;&nbsp;<span style="color:rgb(132,139,152);">)</span><span style="color:rgb(132,139,152);">;</span><br><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br></code></pre>
<p>Here all that is needed is a simple <code>mkIf</code> with a condition of the <code>settings</code>
option not being left empty. In a case where you write to multiple files, you
can use <code>optionalAttrs</code>, like so:</p>
<pre class="highlight"><code class="language-nix"><span style="color:rgb(97,175,239);">files</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(97,175,239);">optionalAttrs</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">settings</span>&nbsp;<span style="color:rgb(171,178,191);">!=</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">)</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">.gtkrc-2.0</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">text</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(97,175,239);">toGtk2Text</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><span style="color:rgb(198,120,221);">inherit</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">)</span>&nbsp;settings<span style="color:rgb(132,139,152);">;</span><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">.config/gtk-3.0/settings.ini</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">text</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(97,175,239);">toGtkINI</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><span style="color:rgb(86,182,194);">Settings</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">settings</span><span style="color:rgb(132,139,152);">;</span><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">.config/gtk-4.0/settings.ini</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">text</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(97,175,239);">toGtkINI</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><span style="color:rgb(86,182,194);">Settings</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">settings</span><span style="color:rgb(132,139,152);">;</span><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(171,178,191);">//</span>&nbsp;<span style="color:rgb(97,175,239);">optionalAttrs</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">css</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">gtk3</span>&nbsp;<span style="color:rgb(171,178,191);">!=</span>&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">)</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">.config/gtk-3.0/gtk.css</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">text</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">css</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">gtk3</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(171,178,191);">//</span>&nbsp;<span style="color:rgb(97,175,239);">optionalAttrs</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">css</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">gtk4</span>&nbsp;<span style="color:rgb(171,178,191);">!=</span>&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">)</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">.config/gtk-4.0/gtk.css</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">text</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">css</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">gtk4</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">}</span><br><span style="color:rgb(132,139,152);">)</span><span style="color:rgb(132,139,152);">;</span><br></code></pre>
<p>This essentially takes the attribute set of <code>files</code> and <em>conditionally</em> adds
attributes defining more files to be written to depending on <em>if</em> the
corresponding option has been set. This is optimal because the first three files
written to share an option due to how GTK configuration works.</p>
<p>One last case is in the Hyprland module, where several checks and several
options are needed to compile into one file. Here is how it is done:</p>
<pre class="highlight"><code class="language-nix"><span style="color:rgb(97,175,239);">files</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(198,120,221);">let</span><br>&nbsp;&nbsp;<span style="color:rgb(171,178,191);">check</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">plugins</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">plugins</span>&nbsp;<span style="color:rgb(171,178,191);">!=</span>&nbsp;<span style="color:rgb(132,139,152);">[</span><span style="color:rgb(132,139,152);">]</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">settings</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">settings</span>&nbsp;<span style="color:rgb(171,178,191);">!=</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">variables</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">noUWSM</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(171,178,191);">config</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">environment</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">sessionVariables</span>&nbsp;<span style="color:rgb(171,178,191);">!=</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><span style="color:rgb(132,139,152);">}</span>&nbsp;<span style="color:rgb(171,178,191);">&amp;&amp;</span>&nbsp;<span style="color:rgb(171,178,191);">!</span><span style="color:rgb(171,178,191);">osConfig</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">programs</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">hyprland</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">withUWSM</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">withUWSM</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(171,178,191);">config</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">environment</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">sessionVariables</span>&nbsp;<span style="color:rgb(171,178,191);">!=</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><span style="color:rgb(132,139,152);">}</span>&nbsp;<span style="color:rgb(171,178,191);">&amp;&amp;</span>&nbsp;<span style="color:rgb(171,178,191);">osConfig</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">programs</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">hyprland</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">withUWSM</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">extraConfig</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">extraConfig</span>&nbsp;<span style="color:rgb(171,178,191);">!=</span>&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;<span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br><span style="color:rgb(198,120,221);">in</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">.config/hypr/hyprland.conf</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">text</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(97,175,239);">mkIf</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(171,178,191);">check</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">plugins</span>&nbsp;<span style="color:rgb(171,178,191);">||</span>&nbsp;<span style="color:rgb(171,178,191);">check</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">settings</span>&nbsp;<span style="color:rgb(171,178,191);">||</span>&nbsp;<span style="color:rgb(171,178,191);">check</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">variables</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">noUWSM</span>&nbsp;<span style="color:rgb(171,178,191);">||</span>&nbsp;<span style="color:rgb(171,178,191);">check</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">extraConfig</span><span style="color:rgb(132,139,152);">)</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(97,175,239);">optionalString</span>&nbsp;<span style="color:rgb(171,178,191);">check</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">plugins</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(97,175,239);">pluginsToHyprconf</span>&nbsp;<span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">plugins</span>&nbsp;<span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">importantPrefixes</span><span style="color:rgb(132,139,152);">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(171,178,191);">+</span>&nbsp;<span style="color:rgb(97,175,239);">optionalString</span>&nbsp;<span style="color:rgb(171,178,191);">check</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">settings</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(97,175,239);">toHyprconf</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">attrs</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">settings</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(198,120,221);">inherit</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">)</span>&nbsp;importantPrefixes<span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(171,178,191);">+</span>&nbsp;<span style="color:rgb(97,175,239);">optionalString</span>&nbsp;<span style="color:rgb(171,178,191);">check</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">variables</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">noUWSM</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(97,175,239);">toHyprconf</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(86,182,194);">attrs</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">env</span>&nbsp;<span style="color:rgb(171,178,191);">=</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(92,99,112);font-style: italic;">#&nbsp;https://wiki.hyprland.org/Configuring/Environment-variables/#xdg-specifications</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">[</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">XDG_CURRENT_DESKTOP,Hyprland</span><span style="color:rgb(152,195,121);">"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">XDG_SESSION_TYPE,wayland</span><span style="color:rgb(152,195,121);">"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">XDG_SESSION_DESKTOP,Hyprland</span><span style="color:rgb(152,195,121);">"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(171,178,191);">++</span>&nbsp;<span style="color:rgb(97,175,239);">mapAttrsToList</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(232,102,113);">key</span><span style="color:rgb(232,102,113);">:</span>&nbsp;<span style="color:rgb(232,102,113);">value</span><span style="color:rgb(232,102,113);">:</span>&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(232,102,113);">${</span><span style="color:rgb(171,178,191);">key</span><span style="color:rgb(232,102,113);">}</span><span style="color:rgb(152,195,121);">,</span><span style="color:rgb(232,102,113);">${</span><span style="color:rgb(171,178,191);">value</span><span style="color:rgb(232,102,113);">}</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">)</span>&nbsp;<span style="color:rgb(171,178,191);">config</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">environment</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">sessionVariables</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(171,178,191);">+</span>&nbsp;<span style="color:rgb(97,175,239);">optionalString</span>&nbsp;<span style="color:rgb(171,178,191);">check</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">extraConfig</span>&nbsp;<span style="color:rgb(171,178,191);">cfg</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">extraConfig</span><br>&nbsp;&nbsp;<span style="color:rgb(132,139,152);">)</span><span style="color:rgb(132,139,152);">;</span><br><br>&nbsp;&nbsp;<span style="color:rgb(92,99,112);font-style: italic;">/*</span><br><span style="color:rgb(92,99,112);font-style: italic;">&nbsp;&nbsp;uwsm&nbsp;environment&nbsp;variables&nbsp;are&nbsp;advised&nbsp;to&nbsp;be&nbsp;separated</span><br><span style="color:rgb(92,99,112);font-style: italic;">&nbsp;&nbsp;(see&nbsp;https://wiki.hyprland.org/Configuring/Environment-variables/)</span><br><span style="color:rgb(92,99,112);font-style: italic;">&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">.config/uwsm/env</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">text</span>&nbsp;<span style="color:rgb(171,178,191);">=</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(97,175,239);">mkIf</span>&nbsp;<span style="color:rgb(171,178,191);">check</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">variables</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">withUWSM</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(97,175,239);">toEnvExport</span>&nbsp;<span style="color:rgb(171,178,191);">config</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">environment</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">sessionVariables</span><span style="color:rgb(132,139,152);">)</span><span style="color:rgb(132,139,152);">;</span><br><br>&nbsp;&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">.config/uwsm/env-hyprland</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">text</span>&nbsp;<span style="color:rgb(171,178,191);">=</span>&nbsp;<span style="color:rgb(198,120,221);">let</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(92,99,112);font-style: italic;">/*</span><br><span style="color:rgb(92,99,112);font-style: italic;">&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;is&nbsp;needed&nbsp;as&nbsp;we're&nbsp;using&nbsp;a&nbsp;predicate&nbsp;so&nbsp;we&nbsp;don't&nbsp;create&nbsp;an&nbsp;empty&nbsp;file</span><br><span style="color:rgb(92,99,112);font-style: italic;">&nbsp;&nbsp;&nbsp;&nbsp;(improvements&nbsp;are&nbsp;welcome)</span><br><span style="color:rgb(92,99,112);font-style: italic;">&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>&nbsp;&nbsp;&nbsp;&nbsp;filteredVars&nbsp;<span style="color:rgb(171,178,191);">=</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(171,178,191);">filterKeysPrefixes</span>&nbsp;<span style="color:rgb(132,139,152);">[</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">HYPRLAND_</span><span style="color:rgb(152,195,121);">"</span>&nbsp;<span style="color:rgb(152,195,121);">"</span><span style="color:rgb(152,195,121);">AQ_</span><span style="color:rgb(152,195,121);">"</span><span style="color:rgb(132,139,152);">]</span>&nbsp;<span style="color:rgb(171,178,191);">config</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">environment</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">sessionVariables</span><span style="color:rgb(132,139,152);">;</span><br>&nbsp;&nbsp;<span style="color:rgb(198,120,221);">in</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(97,175,239);">mkIf</span>&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(171,178,191);">check</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">variables</span><span style="color:rgb(132,139,152);">.</span><span style="color:rgb(86,182,194);">withUWSM</span>&nbsp;<span style="color:rgb(171,178,191);">&amp;&amp;</span>&nbsp;<span style="color:rgb(171,178,191);">filteredVars</span>&nbsp;<span style="color:rgb(171,178,191);">!=</span>&nbsp;<span style="color:rgb(132,139,152);">{</span><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:rgb(132,139,152);">(</span><span style="color:rgb(97,175,239);">toEnvExport</span>&nbsp;<span style="color:rgb(171,178,191);">filteredVars</span><span style="color:rgb(132,139,152);">)</span><span style="color:rgb(132,139,152);">;</span><br><span style="color:rgb(132,139,152);">}</span><span style="color:rgb(132,139,152);">;</span><br></code></pre>
<p>An additional attribute set of boolean aliases is set within a <code>let ... in</code> set
to highlight the different checks done and to add quick ways to reference each
check without excess and redundant code.</p>
<p>First, the file is only written if any of the options to write to the file are
set. <code>optionalString</code> is then used to compile each option's results in an
optimized and clean way.</p>
</body></html></main>
      </div>

      <footer>
        <p><div>
  Built with <a href='https://github.com/feel-co/ndg'>ndg</a> from <a
    href='https://github.com/lunarnovaa/hjem-rum'
  >lunarnovaa/hjem-rum</a>
</div>
<div>
  Protected under <a href='https://creativecommons.org/licenses/by-nc-sa/4.0/'>CC-BY-NC-SA 4.0</a> in accordance with our <a href='https://github.com/lunarnovaa/hjem-rum/blob/main/docs/manual/LICENSE'>LICENSE</a>
</div>
<div>
  For more information on the SNUG, see <a href='https://github.com/snugnug'
  >our repo</a>
</div></p>
      </footer>
    </div>

    
  </body>
</html>
